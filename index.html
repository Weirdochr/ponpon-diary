<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã½ã‚“ã½ã‚“ãƒ€ã‚¤ã‚¢ãƒªãƒ¼</title>
  <link href="https://fonts.googleapis.com/css?family=Kosugi+Maru&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --bg-color: #fff0f5; --text-color: #333; --primary-pink: #FF6B9D; --poop-brown: #8b5a2b; }
    [data-theme="dark"] { --bg-color: #222; --text-color: #eee; }
    [data-theme="poop"] { --bg-color: var(--poop-brown); --text-color: #fff; }
    * { box-sizing: border-box; }
    body { margin:0; padding:0; font-family:'Kosugi Maru',sans-serif; background:var(--bg-color); color:var(--text-color); }
    .container { padding:1rem; }
    .btn { border-radius:1rem!important; }
    .form-label { font-weight:bold; display:flex; align-items:center; gap:0.5rem; }
    .card-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(60px,1fr)); gap:0.5rem; }
    .card-choice { background:#fff; border:2px solid #e5e7eb; border-radius:1rem; padding:0.5rem; text-align:center; cursor:pointer; transition:transform .2s,box-shadow .2s; }
    .card-choice:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,.1); }
    .card-choice.selected { background:var(--primary-pink); border-color:var(--primary-pink); color:#fff; }
    @keyframes shake { 0%,100% { transform: translateX(0);} 25%,75% { transform: translateX(-5px);} 50% { transform: translateX(5px);} }
    .shake { animation: shake 0.3s; }
    #forestLevel { text-align:center; margin:0.5rem 0; font-size:1.1rem; }
    #forestDisplay { font-size:2rem; text-align:center; transition:transform .3s ease; }
  </style>
</head>
<body data-theme="white">
  <div class="container">
    <!-- ä¸»é¢˜åˆ‡æ¢ -->
    <div class="mb-3 text-end">
      <button class="btn btn-sm btn-outline-secondary theme-btn" data-theme="white">â˜ï¸ ãµã‚ãµã‚ç™½</button>
      <button class="btn btn-sm btn-outline-secondary theme-btn" data-theme="dark">ğŸŒ™ ã—ã£ã¨ã‚Šå¤œ</button>
      <button class="btn btn-sm btn-outline-secondary theme-btn" data-theme="poop">ğŸ’© ã†ã‚“ã¡ãƒ–ãƒ©ã‚¦ãƒ³</button>
    </div>
    <ul class="nav nav-tabs mb-3" id="mainTabs" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-record">ğŸ“ ã½ã‚“ã½ã‚“è¨˜éŒ²</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-forest">ğŸŒ² æ£®ã‚’ã®ãã</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-stats">ğŸ“ˆ ã‚‚ã‚ˆã†ã—ã‚­ãƒ£ãƒƒãƒ</button></li>
    </ul>
    <div class="tab-content">
      <!-- è¨˜éŒ² Tab -->
      <div class="tab-pane fade show active" id="tab-record">
        <h3>ğŸ£ ã½ã‚“ã½ã‚“ã‚¿ã‚¤ãƒ ï¼</h3>
        <form id="entryForm" class="card p-4 mb-4">
          <div id="manualFields" class="mb-3">
            <label class="form-label"><span>ğŸ“…</span> ä»Šæ—¥ã¯ã„ã¤ï¼Ÿ</label>
            <input type="date" class="form-control" id="entryDate" required>
            <label class="form-label mt-2"><span>â°</span> ä½•æ™‚ã‹ãªï¼Ÿ</label>
            <input type="time" class="form-control" id="entryTime" required>
          </div>
          <div class="mb-3" id="stateChoicesContainer">
            <label class="form-label"><span>ğŸ’©</span> ã†ã‚“ã¡ã®çŠ¶æ…‹</label>
            <div class="card-grid" id="stateChoices">
              <div class="card-choice" data-value="æ­£å¸¸">âœ… ã°ã£ã¡ã‚Š</div>
              <div class="card-choice" data-value="è»Ÿä¾¿">ğŸ’§ ã·ã‚ˆã·ã‚ˆ</div>
              <div class="card-choice" data-value="ä¸‹ç—¢">ğŸš½ ã‚ºãƒ«ãƒƒ</div>
              <div class="card-choice" data-value="ä¾¿ç§˜">ğŸ”’ ãã‚…ã†ãã‚…ã†</div>
              <div class="card-choice" data-value="è¡€ä¾¿">ğŸ©¸ ãƒ‰ã‚­ãƒ‰ã‚­</div>
            </div>
          </div>
          <div class="mb-3" id="colorChoicesContainer">
            <label class="form-label"><span>ğŸ¨</span> ã†ã‚“ã¡ã®è‰²</label>
            <div class="card-grid" id="colorChoices">
              <div class="card-choice" data-value="èŒ¶è‰²">ğŸ« ãƒãƒ§ã‚³è‰²</div>
              <div class="card-choice" data-value="é»„åœŸè‰²">ğŸŸ¡ ã‚ã‚è‰²</div>
              <div class="card-choice" data-value="é»’ã£ã½ã„">âš«ï¸ ã“ã’èŒ¶</div>
              <div class="card-choice" data-value="èµ¤ã£ã½ã„">ğŸŸ¥ ã¹ã«ã„ã‚</div>
            </div>
          </div>
          <div class="mb-3" id="shapeChoicesContainer">
            <label class="form-label"><span>ğŸŒ</span> ã‹ãŸã¡</label>
            <div class="card-grid" id="shapeChoices">
              <div class="card-choice" data-value="ãƒãƒŠãƒŠçŠ¶">ğŸŒ ãƒãƒŠãƒŠ</div>
              <div class="card-choice" data-value="ç²’çŠ¶">ğŸŒ° ã¤ã¶ã¤ã¶</div>
              <div class="card-choice" data-value="ãƒ‰ãƒ­ãƒ‰ãƒ­">ğŸ’§ ã©ã‚ã©ã‚</div>
            </div>
          </div>
          <div class="mb-3" id="smellChoicesContainer">
            <label class="form-label"><span>ğŸ‘ƒ</span> ã«ãŠã„</label>
            <div class="card-grid" id="smellChoices">
              <div class="card-choice" data-value="ãªã—">ğŸ˜ ã»ã‚ã»ã‚</div>
              <div class="card-choice" data-value="æ™®é€š">ğŸ™‚ ãµã¤ã†</div>
              <div class="card-choice" data-value="å¼·ã„">ğŸ¤¢ ãã•ã£</div>
            </div>
          </div>
          <div class="mb-3" id="urgencyChoicesContainer">
            <label class="form-label"><span>ğŸš¨</span> ç·Šæ€¥åº¦</label>
            <div class="card-grid" id="urgencyChoices">
              <div class="card-choice" data-value="çªç„¶">âš¡ï¸ ã„ããªã‚Š</div>
              <div class="card-choice" data-value="æˆ‘æ…¢ã§ããŸ">â³ ãã‚Šãã‚Š</div>
              <div class="card-choice" data-value="æ™®é€š">ğŸ™‚ ã®ã‚“ã³ã‚Š</div>
            </div>
          </div>
          <div class="mb-3" id="feelingChoicesContainer">
            <label class="form-label"><span>ğŸŒ€</span> å‡ºãŸæ„Ÿã˜</label>
            <div class="card-grid" id="feelingChoices">
              <div class="card-choice" data-value="ã™ã£ãã‚Šã—ãŸ">ğŸ˜„ ã™ã£ãã‚Š</div>
              <div class="card-choice" data-value="æ®‹ä¾¿æ„Ÿã‚ã‚Š">ğŸ˜• ã‚‚ã£ã¨å‡ºãŸã„</div>
              <div class="card-choice" data-value="å‡ºãªã‹ã£ãŸ">ğŸ˜” ãŠã‚ãšã‘</div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label"><span>ğŸ“</span> ã²ã¨ã“ã¨</label>
            <textarea class="form-control" id="memo" rows="2" placeholder="ä½•é£Ÿã¹ãŸï¼Ÿã‚¹ãƒˆãƒ¬ã‚¹ï¼Ÿ"></textarea>
          </div>
          <button class="btn btn-primary" type="submit" id="submitBtn">âœ¨ è¨˜éŒ²ã½ã‚“ï¼</button>
        </form>
      </div>
      <!-- æ£® Tab -->
      <div class="tab-pane fade" id="tab-forest">
        <h3 class="text-center">ğŸŒ³ ã½ã‚“ã½ã‚“ã®æ£®</h3>
        <div id="forestLevel"></div>
        <div id="forestDisplay"></div>
        <p class="text-center text-muted">* 10ã½ã‚“ã§ğŸŒ´ã€20ã½ã‚“ã§ğŸï¸ã€30ã½ã‚“ã§ğŸï¸ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼</p>
      </div>
      <!-- çµ±è¨ˆ Tab -->
      <div class="tab-pane fade" id="tab-stats">
        <h3 class="mb-3 text-center">ğŸ“ˆ ã‚ãŸã—ã®ã½ã‚“çµ±è¨ˆ</h3>
        <div class="d-flex gap-2 justify-content-center mb-3">
          <button class="btn btn-sm btn-outline-primary chart-btn" data-type="bar">ğŸ“Š æ£’ã‚°ãƒ©ãƒ•</button>
          <button class="btn btn-sm btn-outline-primary chart-btn" data-type="line">ğŸ“ˆ æŠ˜ã‚Œç·š</button>
          <button class="btn btn-sm btn-outline-primary chart-btn" data-type="pie">ğŸ¥§ å††ã‚°ãƒ©ãƒ•</button>
        </div>
        <canvas id="statsChart"></canvas>
      </div>
    </div>
  </div>

  <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal fade" id="messageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content text-center">
        <div class="modal-body">
          <p id="modalText" class="mb-0"></p>
        </div>
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Theme switch
    document.querySelectorAll('.theme-btn').forEach(btn=>btn.addEventListener('click',()=>document.body.setAttribute('data-theme',btn.dataset.theme)));
    
    const messageModal = new bootstrap.Modal(document.getElementById('messageModal'));
    function showMessage(text){ document.getElementById('modalText').textContent = text; messageModal.show(); }
    
    // ã‚«ãƒ¼ãƒ‰é¸æŠ
    document.querySelectorAll('.card-choice').forEach(el=>el.addEventListener('click',()=>{
      const c = el.parentElement;
      c.querySelectorAll('.card-choice').forEach(x => x.classList.remove('selected'));
      el.classList.add('selected');
    }));

    // ãƒ¬ã‚³ãƒ¼ãƒ‰ä¿å­˜
    const records = JSON.parse(localStorage.getItem('ponponRecords')||'[]');
    function saveRecord(r){ records.push(r); localStorage.setItem('ponponRecords', JSON.stringify(records)); updateForest(); renderChart(currentChartType); }

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    document.getElementById('entryForm').addEventListener('submit', e => {
      e.preventDefault();
      const required = [
        { id:'stateChoicesContainer', name:'ã†ã‚“ã¡ã®çŠ¶æ…‹' },
        { id:'colorChoicesContainer', name:'ã†ã‚“ã¡ã®è‰²' },
        { id:'shapeChoicesContainer', name:'ã‹ãŸã¡' },
        { id:'smellChoicesContainer', name:'ã«ãŠã„' },
        { id:'urgencyChoicesContainer', name:'ç·Šæ€¥åº¦' },
        { id:'feelingChoicesContainer', name:'å‡ºãŸæ„Ÿã˜' }
      ];
      for(let{ id, name } of required){
        const cont = document.getElementById(id);
        if(!cont.querySelector('.card-choice.selected')){
          cont.classList.add('shake'); setTimeout(()=>cont.classList.remove('shake'),300);
          showMessage(`â—ï¸ ${name} ã‚’æ•™ãˆã¦ã­ï¼`);
          return;
        }
      }
      const r = {
        date: document.getElementById('entryDate').value,
        time: document.getElementById('entryTime').value,
        state: document.querySelector('#stateChoices .selected').dataset.value,
        color: document.querySelector('#colorChoices .selected').dataset.value,
        shape: document.querySelector('#shapeChoices .selected').dataset.value,
        smell: document.querySelector('#smellChoices .selected').dataset.value,
        urgency: document.querySelector('#urgencyChoices .selected').dataset.value,
        feeling: document.querySelector('#feelingChoices .selected').dataset.value,
        memo: document.getElementById('memo').value
      };
      saveRecord(r);
      showMessage('ğŸ‰ ã½ã‚“ã½ã‚“å®Œäº†ï¼');
      e.target.reset();
      document.querySelectorAll('.selected').forEach(x=>x.classList.remove('selected'));
    });

    // æ£®ã®æ›´æ–°
    function updateForest(){
      const count = records.length;
      let icon='ğŸŒ±', level='ç¨®ã¾ã';
      if(count >= 30){ icon='ğŸï¸'; level='å¤§æ£®æ—'; }
      else if(count >=20){ icon='ğŸï¸'; level='å³¶ã®æ£®'; }
      else if(count >=10){ icon='ğŸŒ´'; level='ãƒ¤ã‚·ã®æœ¨'; }
      document.getElementById('forestLevel').textContent = `ã½ã‚“ã½ã‚“æ•°: ${count} â†’ ${level}`;
      document.getElementById('forestDisplay').textContent = icon.repeat(Math.min(Math.floor(count/5),10));
      document.getElementById('forestDisplay').style.transform='scale(1.1)';
      setTimeout(()=>document.getElementById('forestDisplay').style.transform='scale(1)',300);
    }

    // çµ±è¨ˆãƒãƒ£ãƒ¼ãƒˆ
    let chart, currentChartType='bar';
    function renderChart(type){
      currentChartType = type;
      const byDay = {};
      records.forEach(r=> byDay[r.date] = (byDay[r.date]||0)+1);
      const labels = Object.keys(byDay), data = labels.map(d=>byDay[d]);
      const ctx = document.getElementById('statsChart').getContext('2d');
      if(chart) chart.destroy();
      chart = new Chart(ctx,{ type, data:{ labels, datasets:[{ label:'ã½ã‚“å›æ•°', data }] } });
    }
    document.querySelectorAll('.chart-btn').forEach(btn=>btn.addEventListener('click',()=>renderChart(btn.dataset.type)));

    // åˆæœŸåŒ–
    updateForest(); renderChart('bar');
  </script>
</body>
</html>
